<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar Overlap Fix Test - ä¾§è¾¹æ é‡å ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --sidebar-width: 16rem;
            --sidebar-width-icon: 3rem;
            --safe-zone: 1rem;
        }
        
        .test-layout {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        /* Sidebarç›¸å…³æ ·å¼ */
        .sidebar-container {
            position: relative;
            display: block;
            width: fit-content;
        }
        
        .sidebar-gap {
            position: relative;
            width: var(--sidebar-width);
            background: transparent;
            transition: width 0.3s ease;
        }
        
        .sidebar-gap.collapsed {
            width: var(--sidebar-width-icon);
        }
        
        .sidebar-content {
            position: fixed;
            inset: 0;
            z-index: 10;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-right: 2px solid #1e40af;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            display: none;
        }
        
        .sidebar-content.active {
            display: flex;
        }
        
        .sidebar-content.collapsed {
            width: var(--sidebar-width-icon);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ - ä¸¥æ ¼æŒ‰ç…§SidebarInsetè§„èŒƒ */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 1.5rem;
            transition: margin-left 0.3s ease;
            position: relative;
        }
        
        .main-content.collapsed {
            margin-left: var(--sidebar-width-icon);
        }
        
        /* ä¿®å¤åçš„SidebarInsetæ ·å¼æ¨¡æ‹Ÿ */
        .sidebar-inset-fix {
            margin-left: var(--sidebar-width);
            padding-left: 1rem; /* md:pl-1 */
            position: relative;
        }
        
        .sidebar-inset-fix.collapsed {
            margin-left: var(--sidebar-width-icon);
        }
        
        .sidebar-inset-fix::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-width);
            pointer-events: none;
        }
        
        .sidebar-inset-fix.collapsed::before {
            width: var(--sidebar-width-icon);
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 20;
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            width: 280px;
        }
        
        /* çŠ¶æ€æ˜¾ç¤ºå™¨ */
        .status-display {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            z-index: 20;
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            font-family: monospace;
            min-width: 240px;
        }
        
        /* é‡å æ£€æµ‹å™¨ */
        .overlap-detector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            border: 2px solid #fecaca;
            font-weight: 600;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        
        .overlap-detector.show {
            display: block;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.02); }
        }
        
        /* å†…å®¹å¡ç‰‡ */
        .content-card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            position: relative;
        }
        
        /* è¾¹ç•ŒæŒ‡ç¤ºå™¨ */
        .boundary-marker {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }
        
        .boundary-marker.left {
            left: 0;
        }
        
        .boundary-marker.right {
            right: 0;
        }
        
        .boundary-marker.warning {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body>
    <!-- é‡å æ£€æµ‹å™¨ -->
    <div class="overlap-detector" id="overlapDetector">
        âš ï¸ æ£€æµ‹åˆ°Sidebarä¸å†…å®¹é‡å ï¼
    </div>
    
    <div class="test-layout">
        <!-- Sidebar Container -->
        <div class="sidebar-container" id="sidebarContainer">
            <!-- Sidebar Gap (handles layout spacing) -->
            <div class="sidebar-gap" id="sidebarGap"></div>
            
            <!-- Actual Sidebar Content -->
            <div class="sidebar-content active" id="sidebarContent">
                <div class="p-6 flex flex-col h-full">
                    <h2 class="text-xl font-bold text-white mb-6">ğŸ“‹ æµ‹è¯•èœå•</h2>
                    <nav class="space-y-3 flex-1">
                        <div class="p-3 bg-white/20 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/30 transition-all">
                            <div class="text-white font-medium">ğŸ  é¦–é¡µ</div>
                        </div>
                        <div class="p-3 bg-white/10 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/20 transition-all">
                            <div class="text-white font-medium">ğŸ“Š æ•°æ®</div>
                        </div>
                        <div class="p-3 bg-white/10 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/20 transition-all">
                            <div class="text-white font-medium">âš™ï¸ è®¾ç½®</div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Main Content - ä½¿ç”¨ä¿®å¤åçš„SidebarInsetæ ·å¼ -->
        <div class="main-content sidebar-inset-fix" id="mainContent">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-800 mb-8">ğŸ¯ Sidebaré‡å ä¿®å¤æµ‹è¯•</h1>
                
                <div class="content-card">
                    <div class="boundary-marker left"></div>
                    <div class="boundary-marker right"></div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                            <div class="text-sm text-gray-600 mb-1">Sidebarå®½åº¦</div>
                            <div class="text-2xl font-bold text-blue-600" id="sidebarWidth">16rem</div>
                            <div class="text-xs text-gray-500" id="sidebarWidthPx">256px</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                            <div class="text-sm text-gray-600 mb-1">å†…å®¹å·¦è¾¹è·</div>
                            <div class="text-2xl font-bold text-green-600" id="contentMargin">16rem</div>
                            <div class="text-xs text-gray-500" id="contentMarginPx">256px</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                            <div class="text-sm text-gray-600 mb-1">å®‰å…¨çŠ¶æ€</div>
                            <div class="text-2xl font-bold text-purple-600" id="safetyStatus">âœ“ å®‰å…¨</div>
                            <div class="text-xs text-gray-500">æ— é‡å é£é™©</div>
                        </div>
                    </div>
                </div>
                
                <div class="content-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ”§ ä¿®å¤æµ‹è¯•æ§åˆ¶</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">çŠ¶æ€åˆ‡æ¢</h4>
                            <div class="flex flex-wrap gap-2">
                                <button class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors" onclick="toggleState()">
                                    åˆ‡æ¢å±•å¼€/æ”¶èµ·
                                </button>
                                <button class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors" onclick="resetLayout()">
                                    é‡ç½®å¸ƒå±€
                                </button>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">å®½åº¦æµ‹è¯•</h4>
                            <div class="flex flex-wrap gap-2">
                                <button class="px-3 py-1 bg-indigo-500 text-white rounded text-sm hover:bg-indigo-600" onclick="setWidth('12rem')">
                                    çª„ (12rem)
                                </button>
                                <button class="px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700" onclick="setWidth('16rem')">
                                    æ ‡å‡† (16rem)
                                </button>
                                <button class="px-3 py-1 bg-indigo-700 text-white rounded text-sm hover:bg-indigo-800" onclick="setWidth('20rem')">
                                    å®½ (20rem)
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                        <p class="text-yellow-700">
                            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong> æ­¤é¡µé¢æ¨¡æ‹Ÿäº†ä¿®å¤åçš„SidebarInsetç»„ä»¶è¡Œä¸ºã€‚
                            å½“å¸ƒå±€æ­£ç¡®æ—¶ï¼Œç»¿è‰²è¾¹ç•Œçº¿åº”è¯¥ä¸Sidebarå³ä¾§å¯¹é½ï¼Œå†…å®¹åŒºåŸŸä¸åº”è¯¥è¢«é®æŒ¡ã€‚
                        </p>
                    </div>
                </div>
                
                <div class="content-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“‹ ä¿®å¤éªŒè¯æ¸…å•</h3>
                    <ul class="space-y-3 text-gray-600">
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1" id="check1">âœ“</span>
                            <span><strong>åŸºç¡€å·¦è¾¹è·ï¼š</strong> md:ml-[--sidebar-width] ç¡®ä¿æ ‡å‡†å®½åº¦é—´è·</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1" id="check2">âœ“</span>
                            <span><strong>æ”¶èµ·çŠ¶æ€ï¼š</strong> md:peer-data-[state=collapsed]:md:ml-[--sidebar-width-icon] å¤„ç†æ”¶èµ·æƒ…å†µ</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1" id="check3">âœ“</span>
                            <span><strong>å®‰å…¨è¾¹è·ï¼š</strong> md:pl-1 æ·»åŠ é¢å¤–ä¿æŠ¤é˜²æ­¢åƒç´ çº§é‡å </span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1" id="check4">âœ“</span>
                            <span><strong>ä¼ªå…ƒç´ é˜²æŠ¤ï¼š</strong> ::before ä¼ªå…ƒç´ æä¾›é¢å¤–çš„å¸ƒå±€ä¿æŠ¤</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-3 mt-1" id="check5">âœ“</span>
                            <span><strong>çŠ¶æ€è¦†ç›–ï¼š</strong> peer-data çŠ¶æ€é€‰æ‹©å™¨ç¡®ä¿æ‰€æœ‰æƒ…å†µéƒ½è¢«å¤„ç†</span>
                        </li>
                    </ul>
                </div>
                
                <div class="content-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“ æµ‹è¯•å†…å®¹åŒºåŸŸ</h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-white border rounded-lg">
                            <h4 class="font-medium text-gray-700 mb-2">é•¿æ–‡æœ¬æµ‹è¯•</h4>
                            <p class="text-gray-600 text-sm">
                                è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æµ‹è¯•æ–‡æœ¬ï¼Œç”¨æ¥éªŒè¯Sidebarå’Œå†…å®¹åŒºåŸŸä¹‹é—´æ˜¯å¦æœ‰é‡å ã€‚
                                å¦‚æœå¸ƒå±€æ­£ç¡®ï¼Œè¿™æ®µæ–‡å­—åº”è¯¥å®Œå…¨å¯è§ï¼Œä¸ä¼šè¢«å·¦ä¾§çš„Sidebaré®æŒ¡ä»»ä½•éƒ¨åˆ†ã€‚
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            </p>
                        </div>
                        
                        <div class="p-4 bg-white border rounded-lg">
                            <h4 class="font-medium text-gray-700 mb-2">è¡¨æ ¼æ•°æ®æµ‹è¯•</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-sm">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="text-left py-2 px-3 font-medium text-gray-700">é¡¹ç›®</th>
                                            <th class="text-left py-2 px-3 font-medium text-gray-700">çŠ¶æ€</th>
                                            <th class="text-left py-2 px-3 font-medium text-gray-700">è¿›åº¦</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-2 px-3">åŠŸèƒ½å¼€å‘</td>
                                            <td class="py-2 px-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">å®Œæˆ</span></td>
                                            <td class="py-2 px-3">100%</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-2 px-3">æµ‹è¯•éªŒè¯</td>
                                            <td class="py-2 px-3"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">è¿›è¡Œä¸­</span></td>
                                            <td class="py-2 px-3">75%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <h3 class="font-semibold text-gray-800 mb-3">å®æ—¶æ§åˆ¶</h3>
        <div class="space-y-3">
            <button class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" onclick="startContinuousTest()">
                å¼€å§‹è¿ç»­æ£€æµ‹
            </button>
            <button class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors" onclick="forceOverlapCheck()">
                å¼ºåˆ¶é‡å æ£€æµ‹
            </button>
            <div class="text-xs text-gray-500 text-center" id="lastCheck">
                ç­‰å¾…æ£€æµ‹...
            </div>
        </div>
    </div>
    
    <!-- çŠ¶æ€æ˜¾ç¤ºå™¨ -->
    <div class="status-display">
        <div class="text-sm font-medium text-gray-700 mb-2">å¸ƒå±€å‚æ•°</div>
        <div class="space-y-1 text-xs">
            <div>çŠ¶æ€: <span id="currentState" class="font-medium">å±•å¼€</span></div>
            <div>å®½åº¦: <span id="currentWidth" class="font-medium">16rem</span></div>
            <div>å·¦è¾¹è·: <span id="currentMargin" class="font-medium">16rem</span></div>
            <div>å®‰å…¨é—´éš™: <span id="currentGap" class="font-medium text-green-600">å®‰å…¨</span></div>
        </div>
    </div>
    
    <script>
        let isCollapsed = false;
        let currentWidth = '16rem';
        let testInterval = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            checkOverlap();
        });
        
        function toggleState() {
            isCollapsed = !isCollapsed;
            const gap = document.getElementById('sidebarGap');
            const content = document.getElementById('sidebarContent');
            const mainContent = document.getElementById('mainContent');
            
            if (isCollapsed) {
                gap.classList.add('collapsed');
                content.classList.add('collapsed');
                mainContent.classList.add('collapsed');
            } else {
                gap.classList.remove('collapsed');
                content.classList.remove('collapsed');
                mainContent.classList.remove('collapsed');
            }
            
            updateDisplay();
            setTimeout(checkOverlap, 300);
        }
        
        function setWidth(width) {
            document.documentElement.style.setProperty('--sidebar-width', width);
            currentWidth = width;
            updateDisplay();
            setTimeout(checkOverlap, 100);
        }
        
        function resetLayout() {
            document.documentElement.style.setProperty('--sidebar-width', '16rem');
            currentWidth = '16rem';
            isCollapsed = false;
            
            const gap = document.getElementById('sidebarGap');
            const content = document.getElementById('sidebarContent');
            const mainContent = document.getElementById('mainContent');
            
            gap.classList.remove('collapsed');
            content.classList.remove('collapsed');
            mainContent.classList.remove('collapsed');
            
            updateDisplay();
            checkOverlap();
        }
        
        function updateDisplay() {
            const widthRem = parseFloat(currentWidth);
            const widthPx = Math.round(widthRem * 16);
            const iconWidthPx = Math.round(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width-icon')) * 16);
            
            document.getElementById('sidebarWidth').textContent = currentWidth;
            document.getElementById('sidebarWidthPx').textContent = `${widthPx}px`;
            
            if (isCollapsed) {
                document.getElementById('contentMargin').textContent = '3rem';
                document.getElementById('contentMarginPx').textContent = `${iconWidthPx}px`;
                document.getElementById('currentState').textContent = 'æ”¶èµ·';
            } else {
                document.getElementById('contentMargin').textContent = currentWidth;
                document.getElementById('contentMarginPx').textContent = `${widthPx}px`;
                document.getElementById('currentState').textContent = 'å±•å¼€';
            }
            
            document.getElementById('currentWidth').textContent = currentWidth;
            document.getElementById('currentMargin').textContent = isCollapsed ? '3rem' : currentWidth;
        }
        
        function checkOverlap() {
            const detector = document.getElementById('overlapDetector');
            const mainContent = document.getElementById('mainContent');
            const safetyStatus = document.getElementById('safetyStatus');
            const currentGap = document.getElementById('currentGap');
            const checks = document.querySelectorAll('[id^="check"]');
            
            const mainRect = mainContent.getBoundingClientRect();
            const computedStyle = getComputedStyle(mainContent);
            const marginLeft = parseFloat(computedStyle.marginLeft);
            const paddingLeft = parseFloat(computedStyle.paddingLeft);
            const totalOffset = marginLeft + paddingLeft;
            
            const expectedOffset = isCollapsed ? 
                (parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width-icon')) * 16) :
                (parseFloat(currentWidth) * 16);
            
            // å…è®¸å°‘é‡è¯¯å·®ï¼ˆ5pxï¼‰
            const isSafe = Math.abs(totalOffset - expectedOffset) <= 5;
            
            if (isSafe) {
                detector.classList.remove('show');
                safetyStatus.textContent = 'âœ“ å®‰å…¨';
                safetyStatus.className = 'text-2xl font-bold text-purple-600';
                currentGap.textContent = 'å®‰å…¨';
                currentGap.className = 'font-medium text-green-600';
                
                // æ›´æ–°æ£€æŸ¥æ¸…å•
                checks.forEach(check => {
                    check.textContent = 'âœ“';
                    check.className = 'text-green-500 mr-3 mt-1';
                });
            } else {
                detector.classList.add('show');
                safetyStatus.textContent = 'âœ— é‡å ';
                safetyStatus.className = 'text-2xl font-bold text-red-600';
                currentGap.textContent = 'å±é™©';
                currentGap.className = 'font-medium text-red-600';
                
                // æ ‡è®°æœ‰é—®é¢˜çš„æ£€æŸ¥é¡¹
                checks[0].textContent = Math.abs(totalOffset - expectedOffset) > 5 ? 'âœ—' : 'âœ“';
                checks[0].className = Math.abs(totalOffset - expectedOffset) > 5 ? 'text-red-500 mr-3 mt-1' : 'text-green-500 mr-3 mt-1';
            }
            
            document.getElementById('lastCheck').textContent = `æœ€åæ£€æµ‹: ${new Date().toLocaleTimeString()}`;
            return isSafe;
        }
        
        function forceOverlapCheck() {
            checkOverlap();
            if (!checkOverlap()) {
                navigator.vibrate && navigator.vibrate([100, 50, 100]);
            }
        }
        
        function startContinuousTest() {
            const button = event.target;
            
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
                button.textContent = 'å¼€å§‹è¿ç»­æ£€æµ‹';
                button.className = button.className.replace('bg-red-600', 'bg-red-500');
            } else {
                testInterval = setInterval(() => {
                    checkOverlap();
                    // éšæœºåˆ‡æ¢çŠ¶æ€è¿›è¡Œå‹åŠ›æµ‹è¯•
                    if (Math.random() > 0.7) {
                        toggleState();
                    }
                }, 800);
                button.textContent = 'åœæ­¢æ£€æµ‹';
                button.className = button.className.replace('bg-red-500', 'bg-red-600');
            }
        }
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æŸ¥
        window.addEventListener('resize', () => {
            setTimeout(checkOverlap, 100);
        });
    </script>
</body>
</html>