<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataSidebar Overlap Test - æ•°æ®ä¾§è¾¹æ é‡å æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --sidebar-width: 16rem;
            --sidebar-width-icon: 3rem;
            --transition-duration: 0.3s;
        }
        
        .data-sidebar {
            position: fixed;
            inset: 0;
            z-index: 50;
            width: var(--sidebar-width);
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-right: 2px solid #1e40af;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all var(--transition-duration) cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .data-content {
            margin-left: var(--sidebar-width);
            padding: 1.5rem;
            min-height: 100vh;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transition: margin-left var(--transition-duration) cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .data-content.collapsed {
            margin-left: var(--sidebar-width-icon);
        }
        
        .control-panel {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 60;
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .status-indicator {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            z-index: 55;
            background: #ef4444;
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0 0.5rem 0.5rem 0;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
            transition: all var(--transition-duration);
        }
        
        .status-indicator.safe {
            background: #10b981;
        }
        
        .content-card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .overlap-detector {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            border: 2px solid #fecaca;
            font-weight: 600;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .overlap-detector.show {
            display: block;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.02); }
        }
        
        .debug-grid {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 40;
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            display: none;
        }
        
        .debug-grid.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- é‡å æ£€æµ‹å™¨ -->
    <div class="overlap-detector" id="overlapDetector">
        âš ï¸ æ£€æµ‹åˆ°DataSidebarä¸å†…å®¹é‡å ï¼
    </div>
    
    <!-- ç½‘æ ¼è°ƒè¯•å™¨ -->
    <div class="debug-grid" id="debugGrid"></div>
    
    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="status-indicator" id="statusIndicator">
        å±•å¼€çŠ¶æ€ - å®‰å…¨è·ç¦»
    </div>
    
    <!-- DataSidebaræ¨¡æ‹Ÿ -->
    <div class="data-sidebar" id="dataSidebar">
        <div class="p-6">
            <h2 class="text-xl font-bold text-white mb-6">ğŸ“Š Data Sidebar</h2>
            <nav class="space-y-3">
                <div class="p-3 bg-white/20 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/30 transition-all">
                    <div class="text-white font-medium">ğŸ“ˆ æ•°æ®æ¦‚è§ˆ</div>
                    <div class="text-white/80 text-sm mt-1">æŸ¥çœ‹ç»Ÿè®¡æ•°æ®</div>
                </div>
                <div class="p-3 bg-white/10 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/20 transition-all">
                    <div class="text-white font-medium">ğŸ” æ•°æ®æŸ¥è¯¢</div>
                    <div class="text-white/80 text-sm mt-1">æœç´¢å’Œè¿‡æ»¤æ•°æ®</div>
                </div>
                <div class="p-3 bg-white/10 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/20 transition-all">
                    <div class="text-white font-medium">ğŸ“Š å›¾è¡¨åˆ†æ</div>
                    <div class="text-white/80 text-sm mt-1">å¯è§†åŒ–æ•°æ®åˆ†æ</div>
                </div>
                <div class="p-3 bg-white/10 backdrop-blur-sm rounded-lg cursor-pointer hover:bg-white/20 transition-all">
                    <div class="text-white font-medium">âš™ï¸ è®¾ç½®</div>
                    <div class="text-white/80 text-sm mt-1">é…ç½®é€‰é¡¹</div>
                </div>
            </nav>
        </div>
    </div>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="data-content" id="dataContent">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-800 mb-8">ğŸ¯ DataSidebar é‡å æµ‹è¯•</h1>
            
            <div class="content-card">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <div class="text-sm text-gray-600 mb-1">ä¾§è¾¹æ å®½åº¦</div>
                        <div class="text-2xl font-bold text-blue-600" id="sidebarWidth">16rem</div>
                        <div class="text-xs text-gray-500" id="sidebarWidthPx">256px</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                        <div class="text-sm text-gray-600 mb-1">å†…å®¹å·¦è¾¹è·</div>
                        <div class="text-2xl font-bold text-green-600" id="contentMargin">16rem</div>
                        <div class="text-xs text-gray-500" id="contentMarginPx">256px</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                        <div class="text-sm text-gray-600 mb-1">å®‰å…¨é—´éš™</div>
                        <div class="text-2xl font-bold text-purple-600" id="safeGap">âœ“ å®‰å…¨</div>
                        <div class="text-xs text-gray-500">æ— é‡å é£é™©</div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <p class="text-yellow-700">
                        <strong>æµ‹è¯•è¯´æ˜ï¼š</strong> æ­¤é¡µé¢æ¨¡æ‹ŸDataSidebarç»„ä»¶çš„è¡Œä¸ºï¼Œç”¨äºæ£€æµ‹ä¾§è¾¹æ ä¸å†…å®¹åŒºåŸŸæ˜¯å¦å‘ç”Ÿé‡å ã€‚
                        å½“å¸ƒå±€æ­£ç¡®æ—¶ï¼Œå†…å®¹åº”è¯¥å§‹ç»ˆä¿æŒåœ¨ä¾§è¾¹æ å³ä¾§ï¼Œä¸¤è€…ä¹‹é—´æœ‰æ˜ç¡®çš„åˆ†ç•Œçº¿ã€‚
                    </p>
                </div>
            </div>
            
            <div class="content-card">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ”§ æ§åˆ¶é¢æ¿</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-3">ä¾§è¾¹æ æ§åˆ¶</h4>
                        <div class="flex flex-wrap gap-2">
                            <button class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm" onclick="toggleSidebar()">
                                åˆ‡æ¢å±•å¼€/æ”¶èµ·
                            </button>
                            <button class="px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm" onclick="resetLayout()">
                                é‡ç½®å¸ƒå±€
                            </button>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700 mb-3">è°ƒè¯•é€‰é¡¹</h4>
                        <div class="flex flex-wrap gap-2">
                            <button class="px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm" onclick="toggleDebugGrid()">
                                ç½‘æ ¼è¾…åŠ©çº¿
                            </button>
                            <button class="px-3 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm" onclick="forceCheckOverlap()">
                                å¼ºåˆ¶æ£€æµ‹
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-700 mb-2">å®½åº¦è°ƒèŠ‚</h4>
                    <div class="flex flex-wrap gap-2">
                        <button class="px-3 py-1 bg-indigo-500 text-white rounded text-sm hover:bg-indigo-600" onclick="setSidebarWidth('12rem')">
                            çª„ (12rem)
                        </button>
                        <button class="px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700" onclick="setSidebarWidth('16rem')">
                            æ ‡å‡† (16rem)
                        </button>
                        <button class="px-3 py-1 bg-indigo-700 text-white rounded text-sm hover:bg-indigo-800" onclick="setSidebarWidth('20rem')">
                            å®½ (20rem)
                        </button>
                        <button class="px-3 py-1 bg-indigo-800 text-white rounded text-sm hover:bg-indigo-900" onclick="setSidebarWidth('24rem')">
                            è¶…å®½ (24rem)
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="content-card">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“‹ æµ‹è¯•æ•°æ®åŒºåŸŸ</h3>
                <div class="space-y-4">
                    <div class="p-4 bg-white border rounded-lg">
                        <h4 class="font-medium text-gray-700 mb-2">æ•°æ®è¡¨æ ¼ç¤ºä¾‹</h4>
                        <p class="text-gray-600 text-sm">
                            è¿™é‡Œåº”è¯¥æ˜¾ç¤ºæ•°æ®è¡¨æ ¼å†…å®¹ã€‚å¦‚æœå¸ƒå±€æ­£ç¡®ï¼Œæ•´ä¸ªè¡¨æ ¼éƒ½åº”è¯¥å®Œå…¨å¯è§ï¼Œ
                            ä¸ä¼šè¢«å·¦ä¾§çš„DataSidebaré®æŒ¡ä»»ä½•éƒ¨åˆ†ã€‚
                        </p>
                    </div>
                    
                    <div class="p-4 bg-white border rounded-lg">
                        <h4 class="font-medium text-gray-700 mb-2">å›¾è¡¨åŒºåŸŸ</h4>
                        <p class="text-gray-600 text-sm">
                            å›¾è¡¨å’Œå¯è§†åŒ–ç»„ä»¶åº”è¯¥åœ¨æ­¤åŒºåŸŸå†…å®Œæ•´æ˜¾ç¤ºã€‚æ³¨æ„æ£€æŸ¥å·¦å³è¾¹ç•Œæ˜¯å¦éƒ½è¢«æ­£ç¡®è®¡ç®—ã€‚
                        </p>
                    </div>
                    
                    <div class="p-4 bg-white border rounded-lg">
                        <h4 class="font-medium text-gray-700 mb-2">æ“ä½œé¢æ¿</h4>
                        <p class="text-gray-600 text-sm">
                            å„ç§æ“ä½œæŒ‰é’®å’Œæ§åˆ¶å…ƒç´ åº”è¯¥å®Œå…¨å¯è§ï¼Œç”¨æˆ·å¯ä»¥æ— éšœç¢åœ°è®¿é—®æ‰€æœ‰åŠŸèƒ½ã€‚
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="content-card">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">âœ… å¸ƒå±€è§„èŒƒæ£€æŸ¥æ¸…å•</h3>
                <ul class="space-y-3 text-gray-600">
                    <li class="flex items-start">
                        <span class="text-green-500 mr-3 mt-1">âœ“</span>
                        <span><strong>åŸºç¡€é—´è·ï¼š</strong> å†…å®¹åŒºåŸŸå·¦è¾¹è·ç­‰äºä¾§è¾¹æ å®½åº¦</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-3 mt-1">âœ“</span>
                        <span><strong>æ”¶èµ·çŠ¶æ€ï¼š</strong> ä¾§è¾¹æ æ”¶èµ·æ—¶ï¼Œå†…å®¹å·¦è¾¹è·è°ƒæ•´ä¸ºå›¾æ ‡å®½åº¦(3rem)</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-3 mt-1">âœ“</span>
                        <span><strong>å“åº”å¼é€‚é…ï¼š</strong> åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹ä¿æŒæ­£ç¡®çš„é—´è·å…³ç³»</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-3 mt-1">âœ“</span>
                        <span><strong>è¿‡æ¸¡åŠ¨ç”»ï¼š</strong> å±•å¼€/æ”¶èµ·è¿‡ç¨‹ä¸­å¹³æ»‘è¿‡æ¸¡ï¼Œæ— è·³åŠ¨</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-3 mt-1">âœ“</span>
                        <span><strong>å†…å®¹å®Œæ•´æ€§ï¼š</strong> ä»»ä½•çŠ¶æ€ä¸‹å†…å®¹éƒ½ä¸è¢«é®æŒ¡æˆ–æˆªæ–­</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <div class="text-center mb-3">
            <div class="text-sm font-medium text-gray-700">å®æ—¶æ£€æµ‹</div>
            <div class="text-xs text-gray-500" id="lastCheck">ç­‰å¾…æ£€æµ‹...</div>
        </div>
        <button class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm" onclick="continuousMonitor()">
            å¼€å§‹è¿ç»­ç›‘æµ‹
        </button>
    </div>
    
    <script>
        let isCollapsed = false;
        let currentWidth = '16rem';
        let monitorInterval = null;
        let debugGridVisible = false;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplayValues();
            checkOverlap();
        });
        
        function toggleSidebar() {
            const sidebar = document.getElementById('dataSidebar');
            const content = document.getElementById('dataContent');
            const indicator = document.getElementById('statusIndicator');
            
            isCollapsed = !isCollapsed;
            
            if (isCollapsed) {
                sidebar.style.width = 'var(--sidebar-width-icon)';
                content.classList.add('collapsed');
                indicator.textContent = 'æ”¶èµ·çŠ¶æ€ - å®‰å…¨è·ç¦»';
                indicator.classList.add('safe');
            } else {
                sidebar.style.width = 'var(--sidebar-width)';
                content.classList.remove('collapsed');
                indicator.textContent = 'å±•å¼€çŠ¶æ€ - å®‰å…¨è·ç¦»';
                indicator.classList.add('safe');
            }
            
            updateDisplayValues();
            setTimeout(checkOverlap, 300); // åŠ¨ç”»å®Œæˆåæ£€æŸ¥
        }
        
        function setSidebarWidth(width) {
            document.documentElement.style.setProperty('--sidebar-width', width);
            currentWidth = width;
            updateDisplayValues();
            setTimeout(checkOverlap, 100);
        }
        
        function resetLayout() {
            document.documentElement.style.setProperty('--sidebar-width', '16rem');
            currentWidth = '16rem';
            isCollapsed = false;
            
            const sidebar = document.getElementById('dataSidebar');
            const content = document.getElementById('dataContent');
            const indicator = document.getElementById('statusIndicator');
            
            sidebar.style.width = 'var(--sidebar-width)';
            content.classList.remove('collapsed');
            indicator.textContent = 'å±•å¼€çŠ¶æ€ - å®‰å…¨è·ç¦»';
            indicator.classList.add('safe');
            
            updateDisplayValues();
            checkOverlap();
        }
        
        function updateDisplayValues() {
            const sidebarWidthEl = document.getElementById('sidebarWidth');
            const sidebarWidthPxEl = document.getElementById('sidebarWidthPx');
            const contentMarginEl = document.getElementById('contentMargin');
            const contentMarginPxEl = document.getElementById('contentMarginPx');
            
            const widthRem = parseFloat(currentWidth);
            const widthPx = Math.round(widthRem * 16);
            const iconWidthPx = Math.round(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width-icon')) * 16);
            
            sidebarWidthEl.textContent = currentWidth;
            sidebarWidthPxEl.textContent = `${widthPx}px`;
            
            if (isCollapsed) {
                contentMarginEl.textContent = '3rem';
                contentMarginPxEl.textContent = `${iconWidthPx}px`;
            } else {
                contentMarginEl.textContent = currentWidth;
                contentMarginPxEl.textContent = `${widthPx}px`;
            }
        }
        
        function checkOverlap() {
            const detector = document.getElementById('overlapDetector');
            const content = document.getElementById('dataContent');
            const sidebar = document.getElementById('dataSidebar');
            const safeGapEl = document.getElementById('safeGap');
            const indicator = document.getElementById('statusIndicator');
            
            const contentRect = content.getBoundingClientRect();
            const sidebarRect = sidebar.getBoundingClientRect();
            
            // è®¡ç®—å®é™…é—´éš™
            const actualGap = contentRect.left - sidebarRect.right;
            const isSafe = actualGap >= -2; // å…è®¸2pxçš„è¯¯å·®èŒƒå›´
            
            if (isSafe) {
                detector.classList.remove('show');
                safeGapEl.textContent = 'âœ“ å®‰å…¨';
                safeGapEl.className = 'text-2xl font-bold text-green-600';
                indicator.classList.add('safe');
                if (!isCollapsed) {
                    indicator.textContent = 'å±•å¼€çŠ¶æ€ - å®‰å…¨è·ç¦»';
                } else {
                    indicator.textContent = 'æ”¶èµ·çŠ¶æ€ - å®‰å…¨è·ç¦»';
                }
            } else {
                detector.classList.add('show');
                safeGapEl.textContent = 'âœ— é‡å ';
                safeGapEl.className = 'text-2xl font-bold text-red-600';
                indicator.classList.remove('safe');
                indicator.textContent = 'âš ï¸ æ£€æµ‹åˆ°é‡å ';
                indicator.style.background = '#ef4444';
            }
            
            document.getElementById('lastCheck').textContent = `æœ€åæ£€æµ‹: ${new Date().toLocaleTimeString()}`;
            return isSafe;
        }
        
        function forceCheckOverlap() {
            checkOverlap();
            // éœ‡åŠ¨æé†’
            if (!checkOverlap()) {
                navigator.vibrate && navigator.vibrate([100, 50, 100]);
            }
        }
        
        function continuousMonitor() {
            const button = event.target;
            
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
                button.textContent = 'å¼€å§‹è¿ç»­ç›‘æµ‹';
                button.className = button.className.replace('bg-red-600', 'bg-red-500');
            } else {
                monitorInterval = setInterval(checkOverlap, 500);
                button.textContent = 'åœæ­¢ç›‘æµ‹';
                button.className = button.className.replace('bg-red-500', 'bg-red-600');
            }
        }
        
        function toggleDebugGrid() {
            const grid = document.getElementById('debugGrid');
            debugGridVisible = !debugGridVisible;
            
            if (debugGridVisible) {
                grid.classList.add('show');
                event.target.textContent = 'éšè—ç½‘æ ¼';
            } else {
                grid.classList.remove('show');
                event.target.textContent = 'ç½‘æ ¼è¾…åŠ©çº¿';
            }
        }
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æŸ¥
        window.addEventListener('resize', () => {
            setTimeout(checkOverlap, 100);
        });
        
        // æ»šåŠ¨æ—¶æ£€æŸ¥ï¼ˆæŸäº›æƒ…å†µä¸‹å¯èƒ½å½±å“å¸ƒå±€ï¼‰
        window.addEventListener('scroll', () => {
            setTimeout(checkOverlap, 50);
        });
    </script>
</body>
</html>